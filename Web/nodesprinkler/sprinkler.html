<html>
	<head>
		<style>
			.turnedOn{
				background:#000;
			}
		</style>
		<script src="zepto.min.js"></script>
		<script>
			function clearZones(){
				$(".zoneButton").each(function(){
					$(this).removeClass('turnedON');
				});
			}
			function setZones(data){
				clearZones();
				console.log('zoneInfo: ' + data);
				var zoneInfo = $.parseJSON(data);
				for(var i=0; i< zoneInfo.zones.length;i++){
					zoneID = zoneInfo.zones[i].id;
					status = zoneInfo.zones[i].status;
					zoneButton = $("#Zone"+zoneID);
					if(status==1){
						zoneButton.addClass("turnedON");
					}
					else{
						zoneButton.removeClass("turnedON");
					}
				};

			};

			Zepto(function($){
				//Get current sprinkler state in case of refresh
				$.ajax({
					type: 'GET',
					url: '/ALL',
					success: setZones
				});

				$("#all").click(function(){
					var minutes = $("#txtMinutes").val() * 60000;
					callZone('1', 'ON');
					window.setTimeout(function(){
						callZone('2', 'ON');
						window.setTimeout(function(){
							callZone('3', 'ON');
							window.setTimeout(function(){
								callZone('4', 'ON');
								window.setTimeout(function(){
									callZone('4', 'OFF');
								},minutes);
							}, minutes);
						}, minutes);
					}, minutes);
				});

				$(".zoneButton").click(function(){
					var zone = $(this).val();
					if($(this).hasClass("turnedON")){
						callZone(zone, 'OFF');
						return;
					}
					callZone(zone, 'ON');
				});

				function callZone(zone, onOrOff){
					console.log(zone);
					$.ajax({
						type: 'GET',
						url: '/'+zone+'/'+onOrOff,
						success: setZones
					});

				}
			});
		</script>
	</head>
	<body>
		<h1>Run All</h1>
		<input type="textbox" id="txtMinutes" placeholder="minutes" />
		<input type="button" id="all" value="Go"/>

		<h1>Sprinklers</h1>
	 	<input class="zoneButton" type="button" id="Zone1" value="1"/>	
	 	<input class="zoneButton" type="button" id="Zone2" value="2"/>	
	 	<input class="zoneButton" type="button" id="Zone3" value="3"/>	
	 	<input class="zoneButton" type="button" id="Zone4" value="4"/>	
	</body>
</html>

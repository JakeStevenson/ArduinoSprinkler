<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
		<style>
			.turnedOn{
				background:#000;
			}
		</style>
	</head>
	<body>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span3">
				<h2>Cycle</h2>
				<input type="textbox" id="txtMinutes" placeholder="minutes" />
				<input type="button" class="btn btn-primary" id="all" value="Go"/>
			</div>

			<div class="span7">
				<h2>Zones</h2>
				<input class="zoneButton btn" type="button" id="Zone1" value="1"/>	
				<input class="zoneButton btn" type="button" id="Zone2" value="2"/>	
				<input class="zoneButton btn" type="button" id="Zone3" value="3"/>	
				<input class="zoneButton btn" type="button" id="Zone4" value="4"/>	
			</div>
		</div>
		<script src="http://code.jquery.com/jquery.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			function clearZones(){
				$(".zoneButton").each(function(){
					$(this).removeClass('btn-inverse');
				});
			}
			function setZones(data){
				clearZones();
				console.log('zoneInfo: ' + data);
				var zoneInfo = $.parseJSON(data);
				for(var i=0; i< zoneInfo.zones.length;i++){
					zoneID = zoneInfo.zones[i].id;
					status = zoneInfo.zones[i].status;
					zoneButton = $("#Zone"+zoneID);
					if(status==1){
						zoneButton.addClass("btn-inverse");
					}
					else{
						zoneButton.removeClass("btn-inverse");
					}
				};

			};

			$(function(){
				//Get current sprinkler state in case of refresh
				$.ajax({
					type: 'GET',
					url: '/ALL',
					success: setZones
				});

				$("#all").click(function(){
					var minutes = $("#txtMinutes").val() * 60000;
					callZone('1', 'ON');
					window.setTimeout(function(){
						callZone('2', 'ON');
						window.setTimeout(function(){
							callZone('3', 'ON');
							window.setTimeout(function(){
								callZone('4', 'ON');
								window.setTimeout(function(){
									callZone('4', 'OFF');
								},minutes);
							}, minutes);
						}, minutes);
					}, minutes);
				});

				$(".zoneButton").click(function(){
					var zone = $(this).val();
					if($(this).hasClass("btn-inverse")){
						callZone(zone, 'OFF');
						return;
					}
					callZone(zone, 'ON');
				});

				function callZone(zone, onOrOff){
					console.log(zone);
					$.ajax({
						type: 'GET',
						url: '/'+zone+'/'+onOrOff,
						success: setZones
					});

				}
			});
		</script>
	</div>
	</body>
</html>
